---
import { Picture } from "astro:assets";
import type { ImageMetadata } from "astro";

// i18n utilities and data
import { getCurrentLocale, createTranslationFunction, loadTranslations } from "../i18n/utils";
import sponsorsData from "../i18n/data/sponsors.json";

// Load translations
await loadTranslations();

// Get current locale and translation function
const currentLocale = getCurrentLocale(Astro);
const t = createTranslationFunction(currentLocale);

// Define multilingual sponsor types
interface MultilingualCategory {
  name: {
    en: string;
    zh: string;
  };
}

interface MultilingualSponsor {
  category: {
    en: string;
    zh: string;
  };
  image: string;
}

// Import all images
const images = import.meta.glob<{ default: ImageMetadata }>(
    "images/sponsors/*.{jpeg,jpg,png,gif}",
);
---

<div class="filter-container filter-alpha-animate">
    <div class="overlay overlay-dark" data-filter-toggle="close">
        <div class="close" data-filter-toggle="close">
            <div class="close-fill"></div>
            <div class="bar bar-top"></div>
            <div class="bar bar-bottom"></div>
        </div>
    </div>
    <div class="filter-box">
        <p>{t('sponsors.filter')}:</p>
        <div class="filter-group" data-filter-group>
            {sponsorsData.categories.map((category: MultilingualCategory) => (
                <div
                    class="single-filter"
                    data-anchor-target="#grid"
                    data-filter-status={(category.name.en === "All" || category.name.zh === "All") ? "active" : "not-active"}
                    data-filter-category={(category.name[currentLocale] || category.name.en).toLowerCase().replace(/ /g, "-")}
                >
                    <span>{category.name[currentLocale] || category.name.en}</span>
                </div>
            ))}
        </div>
    </div>
</div>

<section
    class="section section-partners-grid"
    id="grid"
    data-filter-section
    data-theme-section="light"
    data-bg-section="lightgray"
>
    <div class="container">
        <div class="row row-filter">
            <div class="col">
                <div class="filter-group" data-filter-group>
                    {
                        sponsorsData.categories.map((category: MultilingualCategory) => (
                            <div
                                class="single-filter"
                                data-filter-status={
                                    (category.name.en === "All" || category.name.zh === "All")
                                        ? "active"
                                        : "not-active"
                                }
                                data-filter-category={(category.name[currentLocale] || category.name.en)
                                    .toLowerCase()
                                    .replace(/ /g, "-")}
                            >
                                <span>{category.name[currentLocale] || category.name.en}</span>
                            </div>
                        ))
                    }
                </div>
            </div>
        </div>
        <div class="grid-wrap visible" data-filter-grid>
            {
                sponsorsData.categories.map(
                    (category: MultilingualCategory) =>
                        (category.name.en !== "All" && category.name.zh !== "All") && (
                            <div
                                class="grid-group"
                                data-filter-status="active"
                                data-filter-category={(category.name[currentLocale] || category.name.en)
                                    .toLowerCase()
                                    .replace(/ /g, "-")}
                            >
                                <div class="row">
                                    <h2 class="h3">{category.name[currentLocale] || category.name.en}</h2>
                                </div>
                                <div class="row grid">
                                    {sponsorsData.partners
                                        .filter(
                                            (partner: MultilingualSponsor) =>
                                                (partner.category[currentLocale] || partner.category.en) ===
                                                (category.name[currentLocale] || category.name.en),
                                        )
                                        .map((partner: MultilingualSponsor) => (
                                            <div class="col">
                                                <div class="single-partners-card card-hover">
                                                    <div class="overlay card-fill" />
                                                    <div class="card-logo boxed-logo">
                                                        {partner?.image &&
                                                            images[
                                                                `/public/images/sponsors/${partner.image}`
                                                            ] && (
                                                                <Picture
                                                                    src={images[
                                                                        `/public/images/sponsors/${partner.image}`
                                                                    ]()}
                                                                    formats={[
                                                                        "webp",
                                                                        "jpg",
                                                                        "png",
                                                                    ]}
                                                                    alt={t('sponsors.logo_alt')}
                                                                    widths={[
                                                                        75, 150,
                                                                        225,
                                                                        450,
                                                                    ]}
                                                                    sizes="(max-width: 480px) 75px, 225px"
                                                                />
                                                            )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                </div>
                            </div>
                        ),
                )
            }
        </div>
    </div>
</section>
