---
// i18n utilities and data
import { getCurrentLocale, createTranslationFunction, loadTranslations } from "../i18n/utils";
import faqData from "../i18n/data/faq.json";

// Load translations
await loadTranslations();

// Get current locale and translation function
const currentLocale = getCurrentLocale(Astro);
const t = createTranslationFunction(currentLocale);

// Define multilingual FAQ types
interface MultilingualCategory {
  name: {
    en: string;
    zh: string;
  };
  id: string;
}

interface MultilingualFAQ {
  question: {
    en: string;
    zh: string;
  };
  answer: {
    en: string;
    zh: string;
  };
  category: string;
}
---

<div class="filter-container filter-alpha-animate">
    <div class="overlay overlay-dark" data-filter-toggle="close">
        <div class="close" data-filter-toggle="close">
            <div class="close-fill"></div>
            <div class="bar bar-top"></div>
            <div class="bar bar-bottom"></div>
        </div>
    </div>
    <div class="filter-box">
        <p>{t('faq.filter')}:</p>
        <div class="filter-group" data-filter-group>
            {faqData.categories.map((category: MultilingualCategory) => (
                <div
                    class="single-filter"
                    data-anchor-target="#grid"
                    data-filter-status={
                        category.id === "all" ? "active" : "not-active"
                    }
                    data-filter-category={category.id}
                >
                    <span>{category.name[currentLocale] || category.name.en}</span>
                </div>
            ))}
        </div>
    </div>
</div>


<section
    class="section section-faq-grid"
    id="grid"
    data-filter-section
    data-theme-section="light"
    data-bg-section="lightgray"
    data-scroll-section
>
    <div class="container">
        <div class="row row-filter">
            <div class="col">
                <div class="filter-group" data-filter-group>
                    {faqData.categories.map((category: MultilingualCategory) => (
                        <button
                            class="single-filter"
                            data-filter-status={category.id === "all" ? "active" : "not-active"}
                            data-filter-category={category.id}
                        >
                            <span>{category.name[currentLocale] || category.name.en}</span>
                        </button>
                    ))}
                </div>
            </div>
        </div>
        <div class="row row-list accordion visible" data-filter-grid>
            {faqData.categories.map((category: MultilingualCategory) => (
                category.id !== "all" &&
                <div
                    class="list-group"
                    data-filter-status="active"
                    data-filter-category={category.id}
                >
                    <div class="row row-mini-title">
                        <div class="card-tags group-tags">
                            <div class="single-tag">
                                <h2 class="p">{category.name[currentLocale] || category.name.en}</h2>
                            </div>
                        </div>
                    </div>
                    <ul class="row row-list">
                        {faqData.faqs.filter((faq: MultilingualFAQ) => faq.category === category.id).map((faq: MultilingualFAQ) => (
                            <li
                                class="single-faq-card single-accordion-item card-hover"
                                data-accordion-status="not-active"
                                data-filter-status="active"
                                data-filter-category={faq.category}
                            >
                                <button class="top" data-accordion-toggle>
                                    <h3 class="h5">{faq.question[currentLocale] || faq.question.en}</h3>
                                    <div class="plus">
                                        <div class="plus-fill" />
                                        <div class="bar bar-top" />
                                        <div class="bar bar-bottom" />
                                    </div>
                                </button>
                                <div class="bottom">
                                    <div class="bottom-wrap">
                                        <div class="bottom-content styled-content">
                                            <p set:html={faq.answer[currentLocale] || faq.answer.en}/>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        ))}
                    </ul>
                </div>
            ))}
        </div>
    </div>
</section>
